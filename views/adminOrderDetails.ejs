<!DOCTYPE html>
<html>
<head>
  <%- include('partials/header1.ejs') %>
  <title>Order <%= order.id %> Details</title>
</head>
<body>
  <header>
    <h1>The Baker Barns Bakery</h1>
    <%- include('partials/navbar1.ejs') %>
  </header>

  <!-- Admin nav -->
  <nav class="cart-container cart-container--wide admin-actionbar">
      <a class="btn btn-accent" href="/adminOnly">Admin Panel</a>
      <a class="btn btn-primary" href="/admin/Orders">Manage Orders</a>
      <a class="btn btn-primary" href="/admin/Products">Manage Products</a>
      <a class="btn btn-primary" href="/admin/Recipes">Manage Recipes</a>
      <a class="btn btn-primary" href="/admin/Users">Manage Users</a>
  </nav>

  <main class="cart-container cart-container--wide">
    <%
      const d = (order.pickup_date instanceof Date) ? order.pickup_date : new Date(order.pickup_date);
      const ymd = isNaN(d) ? '' : d.toISOString().split('T')[0];
      const total = Number(order.total_amount || 0);
    %>

    <h2 style="text-align:left; margin:0 0 12px;">Order #<%= order.id %></h2>

    <!-- Order summary card -->
    <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:12px; margin-bottom:16px;">
      <div class="summary-box" style="background:#fff;">
        <strong>Customer</strong><br>
        <%= order.customer_name || '—' %>
      </div>
      <div class="summary-box" style="background:#fff;">
        <strong>Email</strong><br>
        <%= order.email || '—' %>
      </div>
      <div class="summary-box" style="background:#fff;">
        <strong>Phone</strong><br>
        <%= order.phone || '—' %>
      </div>
      <div class="summary-box" style="background:#fff;">
        <strong>Pickup Date</strong><br>
        <%= ymd %>
      </div>
      <div class="summary-box" style="background:#fff;">
        <strong>Status</strong><br>
        <%= order.status %>
      </div>
      <div class="summary-box" style="background:#fff;">
        <strong>Total</strong><br>
        $<%= total.toFixed(2) %>
      </div>
    </div>

    <h3 style="margin:12px 0;">Items</h3>
    <div class="table-responsive">
      <table class="cart-table cart-table--outlined">
        <thead>
          <tr>
            <th>Product</th>
            <th>Qty</th>
            <th>Price Each</th>
            <th>Subtotal</th>
          </tr>
        </thead>
        <tbody>
          <% items.forEach(item => { 
               const qty = Number(item.quantity || 0);
               const price = Number(item.price_each || 0);
               const sub = qty * price;
          %>
            <tr>
              <td style="text-align:left;">
                <%= item.product_name %>
                <% if (item.custom_cake_order_id) { %>
                  <br><small><em>(Custom Cake)</em></small>
                  <% if (item.custom_options) { %>
                    <br><small><%= item.custom_options %></small>
                  <% } %>
                <% } %>
              </td>
              <td><%= qty %></td>
              <td>$<%= price.toFixed(2) %></td>
              <td>$<%= sub.toFixed(2) %></td>
            </tr>
          <% }) %>
        </tbody>
        <tfoot>
          <tr>
            <td colspan="3" class="text-right"><strong>Total</strong></td>
            <td><strong>$<%= total.toFixed(2) %></strong></td>
          </tr>
        </tfoot>
      </table>
    </div>

    <div style="margin-top:8px;">
      <a href="/admin/orders" class="btn btn-primary">← Back to Orders</a>
    </div>
  </main>

  <footer>
    <p>&copy; 2025 The Baker Barns Bakery</p>
  </footer>
</body>
</html>
